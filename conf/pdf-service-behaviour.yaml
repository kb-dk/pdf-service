#
# This config contains behaviour data: Thread allocation, allowed fields for lookup, limits for arguments etc.
#
# The behaviour config is normally controlled by developers and is part of the code repository.
# Sensitive information such as machine names and user/passwords should not be part of this config.
#
# It will be automatically merged with the environment config when accessed through the
# application config system.
#
#

alma:

  apikey: SHOULD SET IN librarylending-environment.yaml or librarylending-local.yaml


  # The Alma URL. This should never change, you control which alma instance you use by the key, not the url
  url: https://api-eu.hosted.exlibrisgroup.com/almaws/v1/

  lang: da

  #This parameter is nessesary when retrieving Resource Sharing Requests. It does not really matter what it it,
  # but it NEEDS to be the code of any Partner. 800010 is the code of KGL Bib, and not likely to change.
  partner_code: 800010

  #How many requests per call, max 100
  batch_size: 100

  #The alma client will retry this number of times before giving up.
  # If set to negative value, the client will retry forever
  # if set to 0, no retries will be attempted.
  max_retries: 3
  # Not that HTTP 429 (Rate Limit) from ALMA will NOT be affected by this value, and these will always be retried forever

  #cache alma responses for this duration. Milliseconds
  # Cache for 1 minute, to handle repeated calls
  cache_timeout: 60000

  #Timeouts in milliseconds
  connect_timeout: 30000
  read_timeout: 30000

  # Sleep durations when retrying or receiving a response 429 from alma (rate_limit)
  rate_limit:
    #When we retry we back off for at least min_sleep_millis
    min_sleep_millis: 2000
    #to avoid the rush when a lot of threads back off and then try again at the same time, we introduce a random element into
    # the back off time. sleep_variation_millis multiplied with a randon number [0-1] will be added to the sleep time to combat this effect
    sleep_variation_millis: 3000



pdfService:

  # This section controls the settings for the apron page
  apron:
    #This XSLT generates the frontpage
    FOPfile: /home/dodpdfsv/services/conf/frontpage.xsl
    #Relative URLs in this FOPfile will be resolved from the folder containing the FOPfile
    # So you can refer to KBLogo.png simply as "KBLogo.png" without any path

    #These are the values for the metadata-table
    metadataTable:
      # We need these values here, rather than directly in the XSLT because the program needs them to perform
      #  optimal line cutting; We try to remove the fewest number of lines, so that the apron do not spill over onto
      #  2 pages

      widthCM: 9 # Width in centimeters of the left column of the metadata table
      font: HELVETICA # Font of the metadata table
      fontSize: 10 #px

      maxlines:
        # Number of lines available for metadata differ for the different apron types
        A: 14
        B: 15
        C: 12

    # Logic for deciding which of the 4 types of aprons to use
    # See the apron types on https://sbprojects.statsbiblioteket.dk/display/DK/Record+Typer
    # First marc 999a is retried, and then each of the entries below is tried,
    #  in the stated order, starting from the top, until one match
    # If none match, we use the __default__ value.
    # If the __default__ value is not used, we fail...
    999aToApronType:

      # Alle ældre poster, som ikke har et 999a felt, men typisk et 997a felt, får alle samme forklæde A.
      - 999a: __empty__ #Meaning 999a is empty (== not set)
        type: A # Such records is of type A

      # For alle fysiske poster med 999a ( findes kun på pdf’er fra og med 2021),
      # laves der forskellige forklæder A (DOD) eller B (1600talsKUM m.fl.) eller C (Teatermanus)
      # - alt afhængig af for hvilken ”Electronic Collection” der står i 999a.

      # if 999a contains Teatermanus, use apron C
      - 999a: "Teatermanus"
        type: C

      # if 999a contains TeatermanusudenOCR, use apron B
      - 999a: "TeatermanusudenOCR"
        type: B

      # if 999a contains DOD, use apron A
      - 999a: "DOD"
        type: A

      # If no other values match, but 999a is not empty, use Apron B
      - 999a: __default__
        type: B


  #  Where original PDFs are read from
  PDFsource:
    - "/data1/e-mat/dod"
  #  Where generated PDFs are stored
  PDFTempFolder: "/home/dodpdfsv/temp/"
  # If copyrighted PDF is older than this age, request ALMA data and create it again
  # This ensures that updates to ALMA will tage effect (after a while)
  # Note that if this age is SHORTER than the alma.cache_timeout, the cached ALMA record
  # will be used, which defeats the purpose....
  maxAgeOfTempPdfsInMinutes:
    value: 5
    unit: SECONDS
    # unit can be one of NANOS, MICROS, MILLIS, SECONDS, MINUTES, HOURS, HALF_DAYS

  # When inserting new front page, we search for old frontpages to remove
  # If a page contains any of these strings (case insensitive), it is regarded
  # as a frontpage and removed
  # As soon as we find a page that is NOT a frontpage, we stop the search. So there
  # should be no problem with removing pages deep in document
  oldHeaderStrings:
    - "det kongelige bibliotek"
    - "det kgl. bibliotek"

    - "digitaliseret af"
    - "L)iAiNli8St-s1: Af" #Thank you 130020902524.pdf
    - "lDiziHAlise^ af" # Thank you 130020159147.pdf

    - "oplysninger om ophavsret og brugerrettigheder, se venligst"
    - "Os)I/5MNZS»' OM Os)^AV§nsl: c>Z bruZe^ettiZ^Scjer; SS vsnIiZ3H" # Thank you 130020902567.pdf
    - "l^c»' op I/s ni UZE!' om opIiAVZ^ oz bi'UZe^ettjZliecjes', se venIiZS^" # 130020159147.pdf
  #TODO match on apron image instead of this crap


  # How long must pass since publication for at work to be outside copyright
  TimeSincePublicationToBeOutsideCopyright:
    value: 140
    unit: YEARS


  errorMessage: "Denne post kunne ikke fremvises. Hvis du mener det er en fejl, kan du henvende dig til Spørg Biblioteket med et link til den post du prøver at tilgå: https://www.kb.dk/spoerg-biblioteket"

  # Details of the footer to insert for apron type C
  copyrightFooter:
    Text:
      - "Manuskriptkopien må ikke anvendes til opførelse og må ikke videredistribueres"
    #      - "The manuscript copy may not be used for public performance and may not be distributed."
    Fontsize: 12
    #Font is Helvetica, which is unfortunately not configurable

    # See https://www.rapidtables.com/web/color/html-color-codes.html for possible values
    Color: '#FF0000' # Black
    Transparency: 0.7 # Between 0.0 and 1.0. 1.0 is totally covering, i.e. not transparent. 0.0 is invisible

    Background:
      # In order for the footer to be visible on darker backgrounds
      # See https://www.rapidtables.com/web/color/html-color-codes.html for possible values
      Color: '#FFFFFF' # White
      Transparency: 0.3 # Between 0.0 and 1.0. 1.0 is totally covering, i.e. not transparent. 0.0 is invisible

